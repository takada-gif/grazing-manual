<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>放牧マニュアル - デジタル版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .sidebar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .main-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c5530;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            color: #2c5530;
            margin: 30px 0 20px 0;
            padding: 15px 0;
            border-bottom: 2px solid #e8f5e8;
            font-size: 1.8em;
        }

        h3 {
            color: #4CAF50;
            margin: 25px 0 15px 0;
            font-size: 1.4em;
        }

        h4 {
            color: #666;
            margin: 20px 0 10px 0;
            font-size: 1.2em;
        }

        .toc {
            list-style: none;
        }

        .toc li {
            margin: 8px 0;
        }

        .toc a {
            color: #4CAF50;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 5px;
            display: block;
            transition: all 0.3s ease;
        }

        .toc a:hover {
            background-color: #e8f5e8;
            color: #2c5530;
        }

        .toc a.active {
            background-color: #4CAF50;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background-color: #4CAF50;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .calculation-box {
            background: #e8f5e8;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .calculation-box code {
            background: white;
            padding: 10px;
            border-radius: 5px;
            display: block;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }

        .checklist {
            background: #f0f8ff;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .checklist h4 {
            color: #2c5530;
            margin-bottom: 15px;
        }

        .checklist ul {
            list-style: none;
        }

        .checklist li {
            margin: 8px 0;
            padding: 5px 0;
        }

        .checklist input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .emergency-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .emergency-box h4 {
            color: #856404;
            margin-bottom: 15px;
        }

        .template-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .highlight {
            background-color: yellow;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .section {
            margin-bottom: 40px;
        }

        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: none;
        }

        .back-to-top:hover {
            background: #45a049;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .sidebar {
                position: static;
            }
            
            h1 {
                font-size: 2em;
            }
            
            h2 {
                font-size: 1.5em;
            }
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: #4CAF50;
            z-index: 1000;
            transition: width 0.3s ease;
        }

        /* チャットボットスタイル */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            z-index: 1000;
            border: 1px solid #e0e0e0;
        }

        .chatbot-header {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-header h3 {
            margin: 0;
            font-size: 1.1em;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .message.user {
            align-items: flex-end;
        }

        .message.bot {
            align-items: flex-start;
        }

        .message-content {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #4CAF50;
            color: white;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .message-time {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        .chatbot-input {
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            background: white;
            border-radius: 0 0 15px 15px;
        }

        .chatbot-input-container {
            display: flex;
            gap: 10px;
        }

        .chatbot-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 14px;
        }

        .chatbot-input input:focus {
            border-color: #4CAF50;
        }

        .chatbot-send {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .chatbot-send:hover {
            background: #45a049;
        }

        .chatbot-send:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .chatbot-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            font-size: 1.5em;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-toggle:hover {
            background: #45a049;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 5px;
            color: #666;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 2px;
        }

        .typing-dots span {
            width: 4px;
            height: 4px;
            background: #666;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .api-key-input {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
            flex-direction: column;
            gap: 15px;
            min-width: 400px;
        }

        .api-key-input input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .api-key-input button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .api-key-input button:hover {
            background: #45a049;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
        }
    </style>
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>
    
    <div class="container">
        <nav class="sidebar">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="マニュアル内を検索...">
            </div>
            
            <h3>目次</h3>
            <ul class="toc">
                <li><a href="#基本概念">1. 放牧の基本概念</a></li>
                <li><a href="#準備">2. 放牧前の準備</a></li>
                <li><a href="#管理">3. 放牧地の管理</a></li>
                <li><a href="#健康管理">4. 動物の健康管理</a></li>
                <li><a href="#安全対策">5. 安全対策</a></li>
                <li><a href="#装備">6. 必要な装備と道具</a></li>
                <li><a href="#スマート技術">7. スマート放牧技術</a></li>
                <li><a href="#水田放牧">8. 水田放牧の活用</a></li>
                <li><a href="#リーン農業">9. リーン農業の原則</a></li>
                <li><a href="#トラブル">10. トラブルシューティング</a></li>
                <li><a href="#季節">11. 季節別の注意点</a></li>
                <li><a href="#記録">12. 記録と評価</a></li>
                <li><a href="#法規">13. 関連法規と規制</a></li>
                <li><a href="#連絡先">14. 連絡先とリソース</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <h1>放牧マニュアル</h1>

            <section id="基本概念" class="section">
                <h2>放牧の基本概念</h2>
                
                <h3>放牧とは</h3>
                <p>放牧とは、家畜を自然の草地や牧草地で自由に草を食べさせる飼育方法です。動物の自然な行動を尊重し、健康的な成長を促進します。</p>
                
                <h3>放牧の利点</h3>
                <ul>
                    <li><strong>動物の健康</strong>: 自然な運動と新鮮な空気により、動物の健康状態が向上</li>
                    <li><strong>コスト削減</strong>: 飼料代の削減</li>
                    <li><strong>土壌改良</strong>: 動物の排泄物による自然な肥料効果</li>
                    <li><strong>環境保護</strong>: 持続可能な農業の実践</li>
                </ul>
            </section>

            <section id="準備" class="section">
                <h2>放牧前の準備</h2>
                
                <h3>1. 放牧地の選定</h3>
                
                <h4>面積の基準</h4>
                <table>
                    <thead>
                        <tr>
                            <th>動物の種類</th>
                            <th>1頭あたりの必要面積</th>
                            <th>備考</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>乳牛（成牛）</td>
                            <td>0.5-1.0ha</td>
                            <td>草の質により変動</td>
                        </tr>
                        <tr>
                            <td>肉牛（成牛）</td>
                            <td>0.3-0.7ha</td>
                            <td>品種により変動</td>
                        </tr>
                        <tr>
                            <td>子牛</td>
                            <td>0.1-0.3ha</td>
                            <td>月齢により調整</td>
                        </tr>
                        <tr>
                            <td>羊</td>
                            <td>0.05-0.1ha</td>
                            <td>品種により変動</td>
                        </tr>
                        <tr>
                            <td>山羊</td>
                            <td>0.05-0.1ha</td>
                            <td>品種により変動</td>
                        </tr>
                    </tbody>
                </table>

                <h4>地形の条件</h4>
                <ul>
                    <li><strong>傾斜角度</strong>: 15度以下が理想（最大30度まで）</li>
                    <li><strong>標高差</strong>: 100m以内の標高差</li>
                    <li><strong>排水性</strong>: 降雨後24時間以内に水が引くこと</li>
                    <li><strong>土壌</strong>: pH 6.0-7.5の範囲</li>
                </ul>

                <h4>水場の要件</h4>
                <ul>
                    <li><strong>距離</strong>: 放牧地内の任意の地点から200m以内</li>
                    <li><strong>水量</strong>: 成牛1頭あたり50-80L/日</li>
                    <li><strong>水質</strong>: 大腸菌群数100個/mL以下</li>
                    <li><strong>水温</strong>: 夏季25℃以下、冬季5℃以上</li>
                </ul>

                <h3>2. 柵の設置</h3>
                
                <h4>柵の仕様</h4>
                <table>
                    <thead>
                        <tr>
                            <th>動物の種類</th>
                            <th>柵の高さ</th>
                            <th>支柱間隔</th>
                            <th>電圧（電気柵）</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>乳牛</td>
                            <td>1.2-1.5m</td>
                            <td>3-4m</td>
                            <td>3000-5000V</td>
                        </tr>
                        <tr>
                            <td>肉牛</td>
                            <td>1.0-1.2m</td>
                            <td>3-4m</td>
                            <td>3000-5000V</td>
                        </tr>
                        <tr>
                            <td>子牛</td>
                            <td>0.8-1.0m</td>
                            <td>2-3m</td>
                            <td>2000-3000V</td>
                        </tr>
                        <tr>
                            <td>羊</td>
                            <td>0.9-1.1m</td>
                            <td>2-3m</td>
                            <td>4000-6000V</td>
                        </tr>
                        <tr>
                            <td>山羊</td>
                            <td>1.0-1.2m</td>
                            <td>2-3m</td>
                            <td>4000-6000V</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section id="管理" class="section">
                <h2>放牧地の管理</h2>
                
                <h3>草の管理</h3>
                
                <h4>草の高さ管理</h4>
                <table>
                    <thead>
                        <tr>
                            <th>草の種類</th>
                            <th>放牧開始高さ</th>
                            <th>放牧終了高さ</th>
                            <th>再生期間</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>イタリアンライグラス</td>
                            <td>15-20cm</td>
                            <td>5-8cm</td>
                            <td>3-4週間</td>
                        </tr>
                        <tr>
                            <td>オーチャードグラス</td>
                            <td>20-25cm</td>
                            <td>6-10cm</td>
                            <td>4-5週間</td>
                        </tr>
                        <tr>
                            <td>チモシー</td>
                            <td>25-30cm</td>
                            <td>8-12cm</td>
                            <td>5-6週間</td>
                        </tr>
                        <tr>
                            <td>クローバー</td>
                            <td>15-20cm</td>
                            <td>5-8cm</td>
                            <td>3-4週間</td>
                        </tr>
                    </tbody>
                </table>

                <h4>放牧圧の計算</h4>
                <div class="calculation-box">
                    <strong>計算式:</strong>
                    <code>放牧圧 = 動物の体重(kg) × 頭数 ÷ 放牧地の面積(ha)</code>
                    <ul>
                        <li><strong>適正放牧圧</strong>: 200-400kg/ha</li>
                        <li><strong>過放牧の目安</strong>: 500kg/ha以上</li>
                        <li><strong>軽放牧の目安</strong>: 150kg/ha以下</li>
                    </ul>
                </div>

                <h4>ローテーション計画</h4>
                <div class="calculation-box">
                    <strong>計算式:</strong>
                    <code>区画数 = 再生期間(週) ÷ 放牧期間(週) + 1</code>
                    <p><strong>例</strong>：再生期間4週間、放牧期間1週間の場合<br>
                    → 区画数 = 4 ÷ 1 + 1 = 5区画</p>
                </div>

                <h3>水の管理</h3>
                
                <h4>必要水量の計算</h4>
                <table>
                    <thead>
                        <tr>
                            <th>動物の種類</th>
                            <th>体重</th>
                            <th>必要水量(L/日)</th>
                            <th>気温による増加率</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>乳牛</td>
                            <td>500kg</td>
                            <td>50-80</td>
                            <td>夏季+30%</td>
                        </tr>
                        <tr>
                            <td>肉牛</td>
                            <td>400kg</td>
                            <td>40-60</td>
                            <td>夏季+25%</td>
                        </tr>
                        <tr>
                            <td>子牛</td>
                            <td>200kg</td>
                            <td>20-30</td>
                            <td>夏季+20%</td>
                        </tr>
                        <tr>
                            <td>羊</td>
                            <td>50kg</td>
                            <td>5-8</td>
                            <td>夏季+15%</td>
                        </tr>
                        <tr>
                            <td>山羊</td>
                            <td>40kg</td>
                            <td>4-6</td>
                            <td>夏季+15%</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section id="健康管理" class="section">
                <h2>動物の健康管理</h2>
                
                <h3>日常の観察</h3>
                
                <h4>健康チェックリスト</h4>
                <div class="checklist">
                    <h4>毎日のチェック項目</h4>
                    <ul>
                        <li><input type="checkbox"> 群れから離れていないか</li>
                        <li><input type="checkbox"> 正常な歩行をしているか</li>
                        <li><input type="checkbox"> 食欲は正常か</li>
                        <li><input type="checkbox"> 水を飲んでいるか</li>
                        <li><input type="checkbox"> 排泄物に異常がないか</li>
                        <li><input type="checkbox"> 外傷や腫れがないか</li>
                        <li><input type="checkbox"> 目や鼻の分泌物に異常がないか</li>
                    </ul>
                </div>

                <h4>異常行動のサイン</h4>
                <table>
                    <thead>
                        <tr>
                            <th>症状</th>
                            <th>考えられる原因</th>
                            <th>対処法</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>群れから離れる</td>
                            <td>病気、けが、出産</td>
                            <td>個別観察、獣医師連絡</td>
                        </tr>
                        <tr>
                            <td>歩行困難</td>
                            <td>足のけが、関節炎</td>
                            <td>移動制限、治療</td>
                        </tr>
                        <tr>
                            <td>食欲不振</td>
                            <td>消化器疾患、ストレス</td>
                            <td>飼料変更、環境改善</td>
                        </tr>
                        <tr>
                            <td>下痢</td>
                            <td>感染症、飼料問題</td>
                            <td>隔離、獣医師診察</td>
                        </tr>
                        <tr>
                            <td>呼吸困難</td>
                            <td>呼吸器疾患、熱中症</td>
                            <td>緊急治療、獣医師連絡</td>
                        </tr>
                    </tbody>
                </table>

                <h3>定期検査</h3>
                
                <h4>検査スケジュール</h4>
                <table>
                    <thead>
                        <tr>
                            <th>検査項目</th>
                            <th>頻度</th>
                            <th>基準値</th>
                            <th>備考</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>体重測定</td>
                            <td>月1回</td>
                            <td>前月比±5%以内</td>
                            <td>急激な変化に注意</td>
                        </tr>
                        <tr>
                            <td>体温測定</td>
                            <td>週1回</td>
                            <td>38.0-39.5℃</td>
                            <td>発熱時は毎日測定</td>
                        </tr>
                        <tr>
                            <td>血液検査</td>
                            <td>年2回</td>
                            <td>獣医師の判断</td>
                            <td>健康診断時</td>
                        </tr>
                        <tr>
                            <td>寄生虫検査</td>
                            <td>年4回</td>
                            <td>陰性</td>
                            <td>季節の変わり目</td>
                        </tr>
                    </tbody>
                </table>

                <h4>体重測定の方法</h4>
                <div class="calculation-box">
                    <strong>計算式:</strong>
                    <code>体重(kg) = 胸囲(cm)² × 体長(cm) ÷ 10800</code>
                    <ul>
                        <li><strong>胸囲</strong>: 肩甲骨の後ろで測定</li>
                        <li><strong>体長</strong>: 肩から尻までの長さ</li>
                        <li><strong>測定時間</strong>: 毎回同じ時間帯</li>
                    </ul>
                </div>
            </section>

            <section id="安全対策" class="section">
                <h2>安全対策</h2>
                
                <h3>応急処置</h3>
                
                <div class="emergency-box">
                    <h4>軽度の外傷（擦り傷、切り傷）</h4>
                    <ol>
                        <li>傷口を清潔な水で洗浄</li>
                        <li>異物を除去</li>
                        <li>消毒薬を塗布</li>
                        <li>必要に応じて包帯を巻く</li>
                        <li>獣医師に連絡</li>
                    </ol>
                </div>

                <div class="emergency-box">
                    <h4>重度の外傷（深い切り傷、骨折）</h4>
                    <ol>
                        <li>動物を安静にさせる</li>
                        <li>出血があれば圧迫止血</li>
                        <li>即座に獣医師に連絡</li>
                        <li>動物の移動は最小限に</li>
                    </ol>
                </div>

                <div class="emergency-box">
                    <h4>植物中毒の疑いがある場合</h4>
                    <ol>
                        <li>中毒の原因植物を特定</li>
                        <li>動物を中毒源から遠ざける</li>
                        <li>獣医師に即座に連絡</li>
                        <li>可能であれば中毒植物を持参</li>
                    </ol>
                </div>
            </section>

            <section id="記録" class="section">
                <h2>記録と評価</h2>
                
                <h3>放牧日誌の記録項目</h3>
                
                <h4>記録用テンプレート</h4>
                <div class="template-box">
日付: ____年__月__日
天候: 晴/曇/雨/雪
気温: __℃
放牧時間: __:__ - __:__
放牧地: 区画___
動物数: __頭
健康状態: 正常/異常（詳細: ________）
草の高さ: __cm
草の品質: 良/普通/悪
水の状態: 十分/不足
特記事項: ________________
                </div>

                <h3>定期評価</h3>
                
                <h4>月次評価項目</h4>
                <div class="checklist">
                    <ul>
                        <li><input type="checkbox"> 動物の健康状態</li>
                        <li><input type="checkbox"> 体重の変化</li>
                        <li><input type="checkbox"> 草の成長状況</li>
                        <li><input type="checkbox"> 放牧地の状態</li>
                        <li><input type="checkbox"> 水の供給状況</li>
                        <li><input type="checkbox"> 設備の点検結果</li>
                        <li><input type="checkbox"> 問題点と改善策</li>
                    </ul>
                </div>
            </section>

            <section id="連絡先" class="section">
                <h2>連絡先とリソース</h2>
                
                <h3>緊急連絡先</h3>
                <ul>
                    <li><strong>獣医師</strong>: [電話番号を記入]</li>
                    <li><strong>緊急時獣医師</strong>: [電話番号を記入]</li>
                    <li><strong>動物病院</strong>: [電話番号を記入]</li>
                    <li><strong>畜産技術センター</strong>: [電話番号を記入]</li>
                </ul>

                <h3>参考資料</h3>
                <ul>
                    <li>畜産技術指針</li>
                    <li>動物愛護管理法</li>
                    <li>地域の放牧ガイドライン</li>
                    <li>農研機構「スマート放牧導入マニュアル」</li>
                    <li>農研機構「水田放牧の手引き」</li>
                    <li>周年親子放牧導入標準作業手順書</li>
                </ul>
            </section>
        </main>
    </div>

    <button class="back-to-top" id="backToTop">↑</button>

    <!-- チャットボット -->
    <button class="chatbot-toggle" id="chatbotToggle">💬</button>
    
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <h3>放牧マニュアル AI アシスタント</h3>
            <button class="chatbot-close" id="chatbotClose">×</button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="message bot">
                <div class="message-content">
                    こんにちは！放牧マニュアルのAIアシスタントです。放牧に関するご質問がございましたら、お気軽にお聞きください。
                </div>
                <div class="message-time" id="welcomeTime"></div>
            </div>
        </div>
        <div class="typing-indicator" id="typingIndicator">
            <span>AIが回答を考えています</span>
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        <div class="chatbot-input">
            <div class="chatbot-input-container">
                <input type="text" id="chatbotInput" placeholder="放牧について質問してください...">
                <button class="chatbot-send" id="chatbotSend">→</button>
            </div>
        </div>
    </div>

    <!-- APIキー入力モーダル -->
    <div class="overlay" id="overlay"></div>
    <div class="api-key-input" id="apiKeyInput">
        <h3>OpenAI APIキーを入力してください</h3>
        <p>ChatGPTのAPIを使用するために、OpenAIのAPIキーが必要です。</p>
        <input type="password" id="apiKey" placeholder="sk-...">
        <div style="display: flex; gap: 10px;">
            <button id="saveApiKey">保存</button>
            <button id="skipApiKey" style="background: #666;">スキップ</button>
        </div>
        <p style="font-size: 0.9em; color: #666;">
            APIキーは安全にローカルストレージに保存されます。<br>
            スキップした場合、基本的な回答のみ提供されます。
        </p>
    </div>

    <script>
        // 検索機能
        const searchInput = document.getElementById('searchInput');
        const sections = document.querySelectorAll('.section');

        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            
            sections.forEach(section => {
                const text = section.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    section.style.display = 'block';
                    if (searchTerm) {
                        highlightText(section, searchTerm);
                    } else {
                        removeHighlights(section);
                    }
                } else {
                    section.style.display = searchTerm ? 'none' : 'block';
                }
            });
        });

        function highlightText(element, term) {
            removeHighlights(element);
            const walker = document.createTreeWalker(
                element,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );

            const textNodes = [];
            let node;
            while (node = walker.nextNode()) {
                textNodes.push(node);
            }

            textNodes.forEach(textNode => {
                const text = textNode.textContent;
                const regex = new RegExp(`(${term})`, 'gi');
                if (regex.test(text)) {
                    const highlightedText = text.replace(regex, '<span class="highlight">$1</span>');
                    const wrapper = document.createElement('div');
                    wrapper.innerHTML = highlightedText;
                    textNode.parentNode.replaceChild(wrapper, textNode);
                }
            });
        }

        function removeHighlights(element) {
            const highlights = element.querySelectorAll('.highlight');
            highlights.forEach(highlight => {
                highlight.outerHTML = highlight.innerHTML;
            });
        }

        // 目次ナビゲーション
        const tocLinks = document.querySelectorAll('.toc a');
        const sectionsWithIds = document.querySelectorAll('section[id]');

        // スクロール時のアクティブセクション更新
        window.addEventListener('scroll', function() {
            let current = '';
            sectionsWithIds.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (scrollY >= (sectionTop - 200)) {
                    current = section.getAttribute('id');
                }
            });

            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });

            // プログレスバー更新
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('progressBar').style.width = scrolled + '%';
        });

        // スムーススクロール
        tocLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // トップに戻るボタン
        const backToTopBtn = document.getElementById('backToTop');

        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopBtn.style.display = 'block';
            } else {
                backToTopBtn.style.display = 'none';
            }
        });

        backToTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // チェックボックスの状態保存
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            // ローカルストレージから状態を復元
            const savedState = localStorage.getItem(checkbox.id || checkbox.parentElement.textContent.trim());
            if (savedState === 'true') {
                checkbox.checked = true;
            }

            // 状態変更を保存
            checkbox.addEventListener('change', function() {
                localStorage.setItem(this.id || this.parentElement.textContent.trim(), this.checked);
            });
        });

        // チャットボット機能
        let apiKey = localStorage.getItem('openai_api_key');
        let chatHistory = JSON.parse(localStorage.getItem('chat_history') || '[]');

        // マニュアルの内容をコンテキストとして設定
        const manualContext = `
あなたは放牧マニュアルの専門AIアシスタントです。以下の放牧マニュアルの内容に基づいて回答してください。

## 放牧の基本概念
放牧とは、家畜を自然の草地や牧草地で自由に草を食べさせる飼育方法です。動物の自然な行動を尊重し、健康的な成長を促進します。

## 放牧前の準備
### 面積の基準
- 乳牛（成牛）: 0.5-1.0ha
- 肉牛（成牛）: 0.3-0.7ha
- 子牛: 0.1-0.3ha
- 羊: 0.05-0.1ha
- 山羊: 0.05-0.1ha

### 地形の条件
- 傾斜角度: 15度以下が理想（最大30度まで）
- 標高差: 100m以内の標高差
- 排水性: 降雨後24時間以内に水が引くこと
- 土壌: pH 6.0-7.5の範囲

### 水場の要件
- 距離: 放牧地内の任意の地点から200m以内
- 水量: 成牛1頭あたり50-80L/日
- 水質: 大腸菌群数100個/mL以下
- 水温: 夏季25℃以下、冬季5℃以上

## 柵の設置
### 柵の仕様
- 乳牛: 高さ1.2-1.5m、支柱間隔3-4m、電圧3000-5000V
- 肉牛: 高さ1.0-1.2m、支柱間隔3-4m、電圧3000-5000V
- 子牛: 高さ0.8-1.0m、支柱間隔2-3m、電圧2000-3000V
- 羊: 高さ0.9-1.1m、支柱間隔2-3m、電圧4000-6000V
- 山羊: 高さ1.0-1.2m、支柱間隔2-3m、電圧4000-6000V

## 草の管理
### 草の高さ管理
- イタリアンライグラス: 放牧開始15-20cm、終了5-8cm、再生期間3-4週間
- オーチャードグラス: 放牧開始20-25cm、終了6-10cm、再生期間4-5週間
- チモシー: 放牧開始25-30cm、終了8-12cm、再生期間5-6週間
- クローバー: 放牧開始15-20cm、終了5-8cm、再生期間3-4週間

### 放牧圧の計算
放牧圧 = 動物の体重(kg) × 頭数 ÷ 放牧地の面積(ha)
- 適正放牧圧: 200-400kg/ha
- 過放牧の目安: 500kg/ha以上
- 軽放牧の目安: 150kg/ha以下

### ローテーション計画
区画数 = 再生期間(週) ÷ 放牧期間(週) + 1

## 水の管理
### 必要水量
- 乳牛(500kg): 50-80L/日、夏季+30%
- 肉牛(400kg): 40-60L/日、夏季+25%
- 子牛(200kg): 20-30L/日、夏季+20%
- 羊(50kg): 5-8L/日、夏季+15%
- 山羊(40kg): 4-6L/日、夏季+15%

## 動物の健康管理
### 日常の観察項目
- 群れから離れていないか
- 正常な歩行をしているか
- 食欲は正常か
- 水を飲んでいるか
- 排泄物に異常がないか
- 外傷や腫れがないか
- 目や鼻の分泌物に異常がないか

### 検査スケジュール
- 体重測定: 月1回、前月比±5%以内
- 体温測定: 週1回、38.0-39.5℃
- 血液検査: 年2回
- 寄生虫検査: 年4回

### 体重測定の方法
体重(kg) = 胸囲(cm)² × 体長(cm) ÷ 10800

## 応急処置
### 軽度の外傷
1. 傷口を清潔な水で洗浄
2. 異物を除去
3. 消毒薬を塗布
4. 必要に応じて包帯を巻く
5. 獣医師に連絡

### 重度の外傷
1. 動物を安静にさせる
2. 出血があれば圧迫止血
3. 即座に獣医師に連絡
4. 動物の移動は最小限に

### 植物中毒
1. 中毒の原因植物を特定
2. 動物を中毒源から遠ざける
3. 獣医師に即座に連絡
4. 可能であれば中毒植物を持参

## 記録と評価
### 月次評価項目
- 動物の健康状態
- 体重の変化
- 草の成長状況
- 放牧地の状態
- 水の供給状況
- 設備の点検結果
- 問題点と改善策

このマニュアルの内容に基づいて、具体的で実用的な回答を提供してください。専門用語は分かりやすく説明し、必要に応じて計算式や具体的な数値も含めて回答してください。
        `;

        // チャットボットの初期化
        function initChatbot() {
            const chatbotToggle = document.getElementById('chatbotToggle');
            const chatbotContainer = document.getElementById('chatbotContainer');
            const chatbotClose = document.getElementById('chatbotClose');
            const chatbotInput = document.getElementById('chatbotInput');
            const chatbotSend = document.getElementById('chatbotSend');
            const chatbotMessages = document.getElementById('chatbotMessages');
            const typingIndicator = document.getElementById('typingIndicator');

            // チャット履歴の復元
            if (chatHistory.length > 0) {
                chatHistory.forEach(msg => {
                    addMessage(msg.content, msg.role, msg.timestamp);
                });
            }

            // チャットボットの表示/非表示
            chatbotToggle.addEventListener('click', () => {
                if (!apiKey) {
                    showApiKeyModal();
                    return;
                }
                chatbotContainer.style.display = chatbotContainer.style.display === 'none' ? 'flex' : 'none';
                chatbotToggle.style.display = chatbotContainer.style.display === 'flex' ? 'none' : 'flex';
            });

            chatbotClose.addEventListener('click', () => {
                chatbotContainer.style.display = 'none';
                chatbotToggle.style.display = 'flex';
            });

            // メッセージ送信
            function sendMessage() {
                const message = chatbotInput.value.trim();
                if (!message) return;

                addMessage(message, 'user');
                chatbotInput.value = '';
                chatbotSend.disabled = true;

                // タイピングインジケーター表示
                typingIndicator.style.display = 'flex';

                // AI応答の取得
                getAIResponse(message);
            }

            chatbotSend.addEventListener('click', sendMessage);
            chatbotInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // メッセージ追加関数
            function addMessage(content, role, timestamp = null) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${role}`;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.textContent = content;
                
                const timeDiv = document.createElement('div');
                timeDiv.className = 'message-time';
                timeDiv.textContent = timestamp || new Date().toLocaleTimeString('ja-JP', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                messageDiv.appendChild(contentDiv);
                messageDiv.appendChild(timeDiv);
                chatbotMessages.appendChild(messageDiv);
                
                // スクロールを最下部に
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            }

            // AI応答の取得
            async function getAIResponse(userMessage) {
                try {
                    let response;
                    
                    if (apiKey) {
                        // OpenAI APIを使用
                        response = await fetchOpenAIResponse(userMessage);
                    } else {
                        // 基本的な回答（APIキーなし）
                        response = getBasicResponse(userMessage);
                    }

                    // タイピングインジケーター非表示
                    typingIndicator.style.display = 'none';
                    
                    // 応答を表示
                    addMessage(response, 'bot');
                    
                    // チャット履歴に保存
                    chatHistory.push(
                        { content: userMessage, role: 'user', timestamp: new Date().toISOString() },
                        { content: response, role: 'bot', timestamp: new Date().toISOString() }
                    );
                    localStorage.setItem('chat_history', JSON.stringify(chatHistory));
                    
                } catch (error) {
                    console.error('AI応答エラー:', error);
                    typingIndicator.style.display = 'none';
                    addMessage('申し訳ございません。エラーが発生しました。しばらく時間をおいてから再度お試しください。', 'bot');
                } finally {
                    chatbotSend.disabled = false;
                }
            }

            // OpenAI API呼び出し
            async function fetchOpenAIResponse(message) {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: manualContext
                            },
                            ...chatHistory.slice(-10), // 直近10件の履歴を含める
                            {
                                role: 'user',
                                content: message
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            }

            // 基本的な回答（APIキーなし）
            function getBasicResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                if (lowerMessage.includes('面積') || lowerMessage.includes('広さ')) {
                    return `放牧地の面積は動物の種類によって異なります：
・乳牛（成牛）: 0.5-1.0ha
・肉牛（成牛）: 0.3-0.7ha
・子牛: 0.1-0.3ha
・羊: 0.05-0.1ha
・山羊: 0.05-0.1ha

詳細な情報はマニュアルの「放牧前の準備」セクションをご確認ください。`;
                }
                
                if (lowerMessage.includes('柵') || lowerMessage.includes('フェンス')) {
                    return `柵の仕様は動物の種類によって異なります：
・乳牛: 高さ1.2-1.5m、電圧3000-5000V
・肉牛: 高さ1.0-1.2m、電圧3000-5000V
・子牛: 高さ0.8-1.0m、電圧2000-3000V
・羊: 高さ0.9-1.1m、電圧4000-6000V
・山羊: 高さ1.0-1.2m、電圧4000-6000V

詳細はマニュアルの「柵の設置」セクションをご確認ください。`;
                }
                
                if (lowerMessage.includes('水') || lowerMessage.includes('給水')) {
                    return `水の管理について：
・距離: 放牧地内の任意の地点から200m以内
・水量: 成牛1頭あたり50-80L/日
・水質: 大腸菌群数100個/mL以下
・水温: 夏季25℃以下、冬季5℃以上

詳細はマニュアルの「水の管理」セクションをご確認ください。`;
                }
                
                if (lowerMessage.includes('健康') || lowerMessage.includes('病気')) {
                    return `動物の健康管理について：
毎日のチェック項目：
・群れから離れていないか
・正常な歩行をしているか
・食欲は正常か
・水を飲んでいるか
・排泄物に異常がないか
・外傷や腫れがないか

詳細はマニュアルの「動物の健康管理」セクションをご確認ください。`;
                }
                
                return `放牧に関するご質問ありがとうございます。より詳細で専門的な回答をご希望の場合は、OpenAI APIキーを設定していただくと、ChatGPTの高度なAI機能をご利用いただけます。

現在のマニュアルには以下の情報が含まれています：
・放牧前の準備
・放牧地の管理
・動物の健康管理
・安全対策
・記録と評価

具体的なご質問がございましたら、お聞かせください。`;
            }
        }

        // APIキー入力モーダル
        function showApiKeyModal() {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('apiKeyInput').style.display = 'flex';
        }

        function hideApiKeyModal() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('apiKeyInput').style.display = 'none';
        }

        // APIキー保存
        document.getElementById('saveApiKey').addEventListener('click', () => {
            const apiKeyValue = document.getElementById('apiKey').value.trim();
            if (apiKeyValue) {
                localStorage.setItem('openai_api_key', apiKeyValue);
                apiKey = apiKeyValue;
                hideApiKeyModal();
                // チャットボットを開く
                document.getElementById('chatbotContainer').style.display = 'flex';
                document.getElementById('chatbotToggle').style.display = 'none';
            }
        });

        // APIキースキップ
        document.getElementById('skipApiKey').addEventListener('click', () => {
            hideApiKeyModal();
            // チャットボットを開く
            document.getElementById('chatbotContainer').style.display = 'flex';
            document.getElementById('chatbotToggle').style.display = 'none';
        });

        // オーバーレイクリックでモーダル閉じる
        document.getElementById('overlay').addEventListener('click', hideApiKeyModal);

        // チャットボット初期化
        initChatbot();

        // 初回アクセス時にAPIキー入力モーダルを表示
        if (!apiKey && !localStorage.getItem('api_key_skipped')) {
            setTimeout(() => {
                showApiKeyModal();
            }, 1000);
        }
    </script>
</body>
</html>



